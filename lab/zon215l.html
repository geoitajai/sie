<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Lei complementar nº 215/2012</title>
	<link rel="icon" type="image/png" href="http://geo-smu.itajai.local/geo/images/favicon-96x96.png" sizes="96x96">
	<link rel="icon" type="image/png" href="http://geo-smu.itajai.local/geo/images/favicon-16x16.png" sizes="16x16">
	<link rel="icon" type="image/png" href="http://geo-smu.itajai.local/geo/images/favicon-32x32.png" sizes="32x32">
	<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
	<link rel="stylesheet" href="http://geo-smu.itajai.local/geo/lib/leaflet.css" />
	<link rel="stylesheet" href="http://geo-smu.itajai.local/geo/lib/leaflet-search.min.css" />
	<link rel="stylesheet" href="http://geo-smu.itajai.local/geo/lib/leaflet.draw.css" />
	<link rel="stylesheet" href="http://geo-smu.itajai.local/geo/lib/L.Control.MousePosition.css" />

	<style>
		body {
			margin: 0;
			padding: 0;
		}

		#map {
			position: absolute;
			top: 0;
			bottom: 0;
			width: 100%;
		}

		.leaflet-container {
			background: #ffffff;
		}

		td,
		th {
			border: 1px solid #dddddd;
		}

		.legend {
			padding: 6px 8px;
			text-align: left;
			line-height: 18px;
			color: #555;
			background: white;
			box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
			border-radius: 5px;
		}

		.legend i {
			width: 18px;
			height: 18px;
			float: left;
			margin-right: 20px;
		}

		.legend .circle {
			border-radius: 20%;
			width: 15px;
			height: 15px;
		}

		.leaflet-control-draw-measure {
			background-image: url(http: //geo-smu.itajai.local/geo/images/measure-control.png);
		}

		.leaflet-container .leaflet-control-search {
			left: 2px;
		}

		.info {
			padding: 6px 8px;
			background: white;
			background: rgba(255, 255, 255, 0.8);
			box-shadow: 0 0 25px rgba(0, 0, 0, 0.3);
			border-radius: 0px;
		}
	</style>
</head>

<body>
	<div id="map"></div>
	<script src="http://geo-smu.itajai.local/geo/lib/jquery-3.3.1.min.js"></script>
	<script src="http://geo-smu.itajai.local/geo/lib/leaflet.js"></script>
	<script src="http://geo-smu.itajai.local/geo/lib/leaflet-search.min.js"></script>
	<script src="http://geo-smu.itajai.local/geo/lib/leaflet-omnivore.min.js"></script>
	<script src="http://geo-smu.itajai.local/geo/lib/L.Control.MousePosition.js"></script>
	<script src="http://geo-smu.itajai.local/geo/lib/leaflet.draw.js"></script>
	<script src="http://geo-smu.itajai.local/geo/lib/leaflet.measurecontrol.min.js"></script>
	<script src="http://geo-smu.itajai.local/geo/lib/leaflet-hash.js"></script>
	<script>

		var tilegoogle = L.layerGroup();
		var tilesmu = new L.LayerGroup();
		var sdcsc = new L.LayerGroup();

		//div do mapa
		var map = new L.Map('map', {
			zoom: 14,
			minZoom: 11,
			maxZoom: 20,
			maxBounds: [
				//south west
				[-27.1279, -48.8954],
				//north east
				[-26.8074, -48.5845]
			],
			center: new L.latLng([-26.91549, -48.6866]),
			layers: [tilesmu],
			zoomControl: false
		});

		//hash, acesso a coordenadas e zoom pela barra de endereços ex: .html#12/37.7631/-122.4437
		var hash = new L.Hash(map);

		//marca d´água
		L.Control.Watermark = L.Control.extend({
			onAdd: function (map) {
				var img = L.DomUtil.create('img');

				img.src = 'http://geo-smu.itajai.local/geo/images/brasaosmuzoneamento.png';
				img.style.width = '170px';

				return img;
			},
			onRemove: function (map) { }
		});

		L.control.watermark = function (opts) {
			return new L.Control.Watermark(opts);
		}
		L.control.watermark({ position: 'bottomright' }).addTo(map);

		//coordenadas
		L.control.mousePosition({ prefix: 'EPSG:4326:', position: 'bottomright' }).addTo(map);

		//barra escala
		L.control.scale({ imperial: false, position: 'bottomright' }).addTo(map);

		//google image
		new L.TileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
			opacity: 0.6,
			maxZoom: 20,
			transparent: false,
			attribution: '©2018 Google, SMU/Porto, <a href="mailto:jaceguay@itajai.sc.gov.br?Subject=WebGIS" target="_top">SIE</a>',
			subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
		}).addTo(map);

		//Mapa base, viário
		var wmsLayer = L.tileLayer.wms('http://geo-smu.itajai.local:8080/geoserver/ows?', {
			layers: 'geoitj:viewsistemaviarioestilosempauta',
			format: 'image/png8',
			opacity: 0.5,
			minZoom: 14,
			maxZoom: 20,
			attribution: false,
			transparent: true
		}).addTo(map);

		//Mapa base, lotes
		var lotcad = L.tileLayer.wms('http://geo-smu.itajai.local:8080/geoserver/ows?', {
			layers: 'geoitj:viewcadastrovias',
			format: 'image/png',
			opacity: 0.3,
			minZoom: 15,
			maxZoom: 20,
			attribution: false,
			transparent: true
		}).addTo(map);

		//Curvas 10x10
		new L.tileLayer.wms('http://geo-smu.itajai.local:8080/geoserver/ows?', {
			layers: 'geoitj:curvas10x10govest2013',
			format: 'image/png8',
			minZoom: 16,
			maxZoom: 20,
			attribution: false,
			transparent: true
		}).addTo(map);

		//Limites Município
		$.getJSON("http://geo-smu.itajai.local:8080/geoserver/geoitj/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geoitj:geo2007limitesmunicip&outputFormat=application%2Fjson", function (data) {
			L.geoJson(data, {
				style: function (feature) {
					return {
						color: '#000000',
						fill: false
					};
				},
			}).addTo(map);
		});


		//Manchas zoneamento
		$.getJSON("http://geo-smu.itajai.local:8080/geoserver/geoitj/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geoitj:viewzoneamentoclegenda&maxFeatures=10000000&outputFormat=application%2Fjson", function (data) {
			L.geoJson(data, {
				style: function (feature) {
					var corzona;
					cormz = feature.properties.legenda;
					if (cormz == 'ZAP') corzona = "#ffc821";
					else if (cormz == 'ZC 1') corzona = "#917951";
					else if (cormz == 'ZC 2') corzona = "#ff5765";
					else if (cormz == 'ZEA') corzona = "#7cc5ab";
					else if (cormz == 'ZEU') corzona = "#d4d4bc";
					else if (cormz == 'ZIP') corzona = "#c82d2d";
					else if (cormz == 'ZIT') corzona = "#caf5f5";
					else if (cormz == 'ZPA 1') corzona = "#468e57";
					else if (cormz == 'ZPA 2') corzona = "#11cd00";
					else if (cormz == 'ZPN') corzona = "#83cada";
					else if (cormz == 'ZR') corzona = "#96b7ab";
					else if (cormz == 'ZR 1') corzona = "#7090d0";
					else if (cormz == 'ZR 2') corzona = "#b599da";
					else if (cormz == 'ZR 3') corzona = "#da89bc";
					else if (cormz == 'ZSI') corzona = "#ff721b";
					else if (cormz == 'ZTRA') corzona = "#fdf5b0";
					else if (cormz == 'ZTRU') corzona = "#bfdb99";
					else if (cormz == 'ZU 1') corzona = "#ef8242";
					else if (cormz == 'ZU 2') corzona = "#e9e9a8";
					else if (cormz == 'ZU 3') corzona = "#ffff00";
					else if (cormz == 'ZU 4') corzona = "#deb239";
					else if (cormz == 'ZU 5') corzona = "#8c8a23";
					else corzona = "#fff";
					return { stroke: false, fillColor: corzona, fillOpacity: 0.4 };
				},

				onEachFeature: function (feature, layer) {
					layer.bindPopup(
						'<strong>' + 'Zona: ' + feature.properties.legenda + '</strong>' + '<br/>' +
						'<table>' +
						'<tr>' +
						'<td>' +
						'Usos permitidos: ' + feature.properties.permitidos + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Usos permissíveis: ' + feature.properties.permissiv + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Altura máxima: ' + feature.properties.alturamax + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Altura máxima do embasamento: ' + feature.properties.alturaemb + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Coeficiente de aproveitamento: ' + feature.properties.coefaprov + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Taxa de ocupação embasamento: ' + feature.properties.toemb + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Taxa de ocupação torre: ' + feature.properties.totorre + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Taxa de permeabilidade: ' + feature.properties.permeab + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Recuo frontal: ' + feature.properties.embrecfron + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Recuos laterais e fundos: ' + feature.properties.embreclat + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Recuos laterais e fundos com aberturas: ' + feature.properties.embreclatc + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Área mínima do lote: ' + feature.properties.lotemaxare + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Testada mínima do lote: ' + feature.properties.lotemaxtes + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Profundidade mínima do lote: ' + feature.properties.lotemaxpro +
						'</td>' +
						'</tr>' +
						'</table>'
					)
				}
			}).addTo(map).bringToBack();
		});

		//perímetro urbano
		$.getJSON("http://geo-smu.itajai.local:8080/geoserver/geoitj/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geoitj:perimetrourbano79&maxFeatures=10000000&outputFormat=application%2Fjson", function (data) {
			L.geoJson(data, {
				style: function (feature) {
					return { color: "#ff0000", dashArray: "10 10", Opacity: 0.8 };
				},

				onEachFeature: function (feature, layer) {
					layer.bindPopup(
						'Perímetro urbano, leis 1764/79 e 4157/04'
					);
				}
			}).addTo(map);
		});

		//Sistema viário para pesquisa
		var pesquisa = new L.LayerGroup();
		$.getJSON("http://geo-smu.itajai.local:8080/geoserver/geoitj/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geoitj:viewsistemaviariopts&outputFormat=application%2Fjson", function (data) { L.geoJson(data).addTo(pesquisa) });

		//ZPA3
		$.getJSON("http://geo-smu.itajai.local:8080/geoserver/geoitj/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geoitj:viewzonzpa3&maxFeatures=10000000&outputFormat=application%2Fjson", function (data) {
			L.geoJson(data, {
				style: function (feature) {
					return { stroke: false, fillColor: "#71b580", fillOpacity: 0.4 };
				},

				onEachFeature: function (feature, layer) {
					layer.bindPopup(
						'<strong>' + 'Zona: ' + feature.properties.nome + '</strong>' + '<br/>' +
						'<table>' +
						'<tr>' +
						'<td>' +
						'Usos permitidos: ' + feature.properties.permitidos + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Usos permissíveis: ' + feature.properties.permissiv + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Altura máxima: ' + feature.properties.alturamax + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Altura máxima do embasamento: ' + feature.properties.alturaemb + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Coeficiente de aproveitamento: ' + feature.properties.coefaprov + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Taxa de ocupação embasamento: ' + feature.properties.toemb + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Taxa de ocupação torre: ' + feature.properties.totorre + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Taxa de permeabilidade: ' + feature.properties.permeab + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Recuo frontal: ' + feature.properties.embrecfron + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Recuos laterais e fundos: ' + feature.properties.embreclat + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Recuos laterais e fundos com aberturas: ' + feature.properties.embreclatc + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Área mínima do lote: ' + feature.properties.lotemaxare + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Testada mínima do lote: ' + feature.properties.lotemaxtes + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Profundidade mínima do lote: ' + feature.properties.lotemaxpro +
						'</td>' +
						'</tr>' +
						'</table>'
					)
				}
			}).addTo(map);
		});

		//Controle de layers
		var aerogab = L.layerGroup();
		var ccs = L.layerGroup();

		//Gabarito aeroporto
		$.getJSON("http://geo-smu.itajai.local:8080/geoserver/geoitj/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geoitj:aeroportogabarito&maxFeatures=10000000&outputFormat=application%2Fjson", function (data) {
			L.geoJson(data, {
				style: function (feature) {
					var coraero,
						corae = feature.properties.descr;
					if (corae == 'área de aproximação 1') coraero = "#b14ee9";
					else if (corae == 'superfície horizontal interna') coraero = "#926de8";
					else if (corae == 'superfície cônica') coraero = "#629de8";
					else if (corae == 'área de aproximação 2') coraero = "#1ce3e6";
					else coraero = "#fff";
					return { stroke: false, fillColor: coraero, fillOpacity: 0.4 };
				},

				onEachFeature: function (feature, layer) {
					layer.bindPopup(
						'Altura=' + feature.properties.altmax + 'm'
					);
				}
			}).addTo(aerogab);
		});

		//Linhas aeroporto
		$.getJSON("http://geo-smu.itajai.local:8080/geoserver/geoitj/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geoitj:aeroportoconelinhas&maxFeatures=10000000&outputFormat=application%2Fjson", function (data) {
			L.geoJson(data, {
				style: function (feature) {
					return { color: "#4d4d4d", dashArray: "30 10", Opacity: 0.6 };
				}
			}).addTo(aerogab);
		});

		//CCS
		$.getJSON("http://geo-smu.itajai.local:8080/geoserver/geoitj/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geoitj:zon2012bcss&maxFeatures=10000000&outputFormat=application%2Fjson", function (data) {
			L.geoJson(data, {
				style: function (feature) {
					var corlinhaccs,
						corcss = feature.properties.tipo;
					if (corcss == 'CCS1') corlinhaccs = "#ff0000";
					else if (corcss == 'CCS2') corlinhaccs = "#723900";
					else if (corcss == 'CCS3') corlinhaccs = "#b82e00";
					else corlinhaccs = "#fff";
					return { color: corlinhaccs, weight: 5, Opacity: 0.4 };
				},

				onEachFeature: function (feature, layer) {
					layer.bindPopup(
						'<strong>' + 'Nome: ' + feature.properties.tipo + '</strong>' + '<br/>' +
						'<table>' +
						'<tr>' +
						'<td>' +
						'Usos permitidos: ' + feature.properties.permitidos + '<br/>' +
						'</td>' +
						'</tr>' +
						'<tr>' +
						'<td>' +
						'Usos permissíveis: ' + feature.properties.permissiv + '<br/>' +
						'</td>' +
						'</tr>' +
						'</table>'
					);
				}
			}).addTo(ccs);
		});

		//Área de segurança pública - SDC/SC
		$.getJSON("http://geo-smu.itajai.local:8080/geoserver/geoitj/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geoitj:sdsscareasegur&maxFeatures=10000000&outputFormat=application%2Fjson", function (data) {
			L.geoJson(data, {
				style: function (feature) {
					return { color: "#006600", fillColor: "#00ff00", fillOpacity: 0.4 };
				},
				onEachFeature: function (feature, layer) {
					layer.bindPopup(
						'<strong> Área de segurança e recuperação ambiental <br/> Sob responsabilidade da Secretaria de Estado da Defesa Civil SDC/SC </strong> <br/> Obras de melhoramentos fluvial no canal retificado e calha do rio Itajaí-Mirim <br/> Construção de comportas de regulação.'
					),
						layer.bindTooltip('Área de segurança<br/>e recuperação ambiental', { sticky: true, direction: 'center' })
				}
			}).addTo(sdcsc);
		});

		//Pesquisa por código cadastro
		//elemento destacado
		var pesquisaQ = L.featureGroup().addTo(map);
		function elementoNavQ() {
			let inputpesquisaQ = document.forms["pesquisaquadra"]["setorQuadra"].value;
			pesquisaQ.clearLayers();
			$.getJSON("http://geo-smu.itajai.local:8080/geoserver/wfs?service=wfs&version=1.0.0&request=getfeature&typename=geoitj:tmimgeom&outputFormat=application%2Fjson&CQL_FILTER=ncodimov='" + inputpesquisaQ + "'",
				function (data) {
					let error = data.totalFeatures;
					if (error == 0) {
						alert('não encontrado');
					}
					else {
						L.geoJson(data, {
							style: function (feature) {
								return { color: '#000000', fill: false, weight: 5 }
							}
						}).addTo(pesquisaQ);
						let dataq = pesquisaQ.getBounds();
						map.flyToBounds(dataq);
						//async para a tabela
						let promise = new Promise(function (resolve, reject) {
							resolve(data.features["0"].properties.inscrlig);
						});
					};
				});
		};

		//caixa de pesquisa
		var InfoControl = L.Control.extend({
			options: { position: "topleft" },

			onAdd: function (map) {
				this._div = L.DomUtil.create('div', 'info');
				L.DomEvent.disableClickPropagation(this._div);
				this.update();
				return this._div;
			},
			update: function (d) {
				this._div.innerHTML =
					'<form name="pesquisaquadra" action="" onsubmit="elementoNavQ(); return false;" method="post">' +
					'<input type="submit" value="Pesquisa por cód.cadastro">' + '</br>' +
					'<input type="text" placeholder="digite o código" name="setorQuadra">' +
					'</form>';
			}
		});
		var info = new InfoControl().addTo(map);

		//inundações
		//layer.bindTooltip(feature.properties.legenda, { sticky: true, direction: 'center' })
		//Cotas 2013 (setembro)
		var inundasetembro2011 = L.layerGroup();
		//Cotas 2011 (setembro)
		$.getJSON("http://10.10.1.158:8080/geoserver/geoitj/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geoitj:inundasetembro2011&outputFormat=application%2Fjson", function (data) {
			L.geoJson(data, {
				style: function (feature) {
					var corlinha,
						corl = feature.properties.situa;
					if (corl == '0,20') corlinha = "#ffffcc";
					else if (corl == '0,21 a 0,40') corlinha = "#ffeda0";
					else if (corl == '0,41 a 0,60') corlinha = "#fed976";
					else if (corl == '0,50') corlinha = "#feb24c";
					else if (corl == '0,51 a 1') corlinha = "#fd8d3c";
					else if (corl == '1,01 a 1,50') corlinha = "#fc4e2a";
					else if (corl == '1,51 a 2') corlinha = "#e31a1c";
					else if (corl == '2,01 a 3') corlinha = "#b10026";
					else corlinha = "#fff";
					return { weight: 1, fillColor: corlinha, fillOpacity: 0.8 };
				},

				onEachFeature: function (feature, layer) {
					let tippadrao =
					if (corl == '0,20') corlinha = "#ffffcc";
					else if (corl == '0,21 a 0,40') corlinha = "#ffeda0";
					else if (corl == '0,41 a 0,60') corlinha = "#fed976";
					else if (corl == '0,50') corlinha = "#feb24c";
					else if (corl == '0,51 a 1') corlinha = "#fd8d3c";
					else if (corl == '1,01 a 1,50') corlinha = "#fc4e2a";
					else if (corl == '1,51 a 2') corlinha = "#e31a1c";
					else if (corl == '2,01 a 3') corlinha = "#b10026";
					else corlinha = "#fff";
					return { weight: 1, fillColor: corlinha, fillOpacity: 0.8 };
					;
					layer.bindTooltip(feature.properties.legenda, { sticky: true, direction: 'center' });
				}
			}).addTo(inundasetembro2011).addTo(map);
		});

		//Controle de camadas
		var overlayMaps = {
			"<a href='http://servicos.decea.gov.br/aga/' target='_blank' > DECEA <br/> Portaria nº957/GC3-7/2015</a>": aerogab,
			"Corredores de <br/> comércio e serviços": ccs
		};
		var baseMaps = {
			"Vias<a href='https://docs.google.com/spreadsheets/d/e/2PACX-1vQBLSrcsNMwpbaF1ShxlSLeX7CdHAmOkX452MEoYgDEbMIF41DJmvN4Y2yv6Ge0nOp8DDh4B4r40xQG/pubhtml?gid=61646311&single=true' target='_blank' >(Tabela, pauta)</a>": tilesmu,
			"Imagem Google maps": tilegoogle
		};
		L.control.layers(baseMaps, overlayMaps, { position: 'bottomleft', collapsed: false }).addTo(map);

		//Controle camada SDS on zoom 15+
		map.on('zoomend', function () {
			if (map.getZoom() < 15) {
				map.removeLayer(sdcsc);
			}
			else {
				map.addLayer(sdcsc);
			};
		});

		//Barra pesquisa
		var searchControl = new L.Control.Search({
			layer: pesquisa,
			propertyName: 'nome',
			circleLocation: false,
			marker: false,
			textPlaceholder: "Pesquisa nome logradouro",
			textErr: "Não localizado",
			textCancel: "Cancelar",
			zoom: 18,
			openPopup: false,
			collapsed: false,
			initial: false,
			position: 'topleft',
			minLength: 2
		});
		map.addControl(searchControl);
		//camada não precisa ser visível, apenas para searchcontrol
		map.removeLayer(pesquisa);

		//Botão zoom posicionado
		L.control.zoom({
			position: 'topleft'
		}).addTo(map);

		//Medidas
		L.Control.measureControl().addTo(map);

	</script>
</body>

</html>