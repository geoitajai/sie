<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Secretaria Municipal de Administração</title>
		<link rel="icon" type="image/png" href="images/favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="images/favicon-16x16.png" sizes="16x16">
		<link rel="icon" type="image/png" href="images/favicon-32x32.png" sizes="32x32">
		<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" href="lib/leaflet.css" />
		<link rel="stylesheet" href="lib/leaflet-search.min.css" />
		<link rel="stylesheet" href="lib/leaflet.draw.css" />
		<link rel="stylesheet" href="lib/L.Control.MousePosition.css" />
		<link rel="stylesheet" href="lib/MarkerCluster.css" />
		<link rel="stylesheet" href="lib/MarkerCluster.Default.css" />

		<style>
			body {
				margin: 0;
				padding: 0;
			}

			#map {
				position: absolute;
				top: 0;
				bottom: 0;
				width: 100%;
			}

			.leaflet-container {
				background: #ffffff;
			}

			td, th {
				border: 1px solid #dddddd;
			}

			.legend {
				padding: 6px 8px;
				text-align: left;
				line-height: 18px;
				color: #555;
				background : white;
				box-shadow: 0 0 15px rgba(0,0,0,0.2);
				border-radius: 5px;
			}

			.legend i {
				width: 18px;
				height: 18px;
				float: left;
				margin-right: 20px;
			}

				.legend .circle {
				border-radius: 20%;
				width: 15px;
				height: 15px;
			}

			.leaflet-control-draw-measure {
				background-image: url(images/measure-control.png);
			}
			
			.leaflet-container .leaflet-control-search {				
				left: 2px;
			}			
		</style>
	</head>

	<body>
		<div id="map"></div>
		<script src="lib/leaflet.js"></script>
		<script src="lib/leaflet-search.min.js"></script>
		<script src="lib/leaflet-omnivore.min.js"></script>
		<script src="lib/leaflet.markercluster.js"></script>
		<script src="lib/L.Control.MousePosition.js"></script>
		<script src="lib/leaflet.draw.js"></script>
		<script src="lib/leaflet.measurecontrol.min.js"></script>
		<script src="lib/leaflet.markercluster.layersupport.js"></script>
		<script src="lib/leaflet-hash.js"></script>
		<script>

		var tilegoogle = L.layerGroup();
		var tilesmu = new L.LayerGroup();
		var pesquisa = new L.LayerGroup();
		var sau = new L.LayerGroup();
		var ppubl = new L.LayerGroup();
		var educa = new L.LayerGroup();
		var dsocial = new L.LayerGroup();
		var cessuso = new L.LayerGroup();
		var esportiv = new L.LayerGroup();
		var pracas = new L.LayerGroup();

		//div do mapa
		var map = new L.Map('map', {
			zoom: 14,
			minZoom: 12,
			maxZoom: 17,
			maxBounds: [
				//south west
				[-27.1279, -48.8954],
				//north east
				[-26.8074, -48.5845]
			],
			center: new L.latLng([-26.906960, -48.685425]),
			layers:[ tilesmu ],
			measureControl: true
		});
		
		//hash, acesso a coordenadas e zoom pela barra de endereços ex: .html#12/37.7631/-122.4437
		var hash = new L.Hash(map);

		//coordenadas
		L.control.mousePosition().addTo(map);

		//barra escala
		L.control.scale({imperial: false}).addTo(map);

		//marca d´água
		L.Control.Watermark = L.Control.extend({
			onAdd: function(map) {
				var img = L.DomUtil.create('img');

				img.src = 'images/brasaoadm.png';
				img.style.width = '250px';

				return img;
			},
			onRemove: function(map) {}
		});

		L.control.watermark = function(opts) {
			return new L.Control.Watermark(opts);
		}
		L.control.watermark({ position: 'bottomleft' }).addTo(map);

		//Mapa base, google
		new L.TileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
			opacity: 0.6,
			maxZoom: 19,
			transparent: false,
			attribution: '©2018 Google, Secretaria Municipal de Administração, <a href="mailto:jaceguay@itajai.sc.gov.br?Subject=WebGIS" target="_top">SIE</a>',
			subdomains:['mt0','mt1','mt2','mt3']
		}).addTo(tilegoogle);

		//zona urbana e geral
		new L.TileLayer('tiles/basemap/10-17/{z}/{x}/{y}.png', {
			opacity: 0.6,
			minZoom: 10,
			attribution: 'Secretaria Municipal de Administração, <a href="mailto:jaceguay@itajai.sc.gov.br?Subject=WebGIS" target="_top">SIE</a>',
			maxZoom: 17
		}).addTo(tilesmu);

		//zona rural, zoom 17
		new L.TileLayer('tiles/basemap/17rural/{z}/{x}/{y}.png', {
			opacity: 0.6,
			minZoom: 17,
			maxZoom: 17
		}).addTo(tilesmu);

		//bairros
		map.addLayer(new L.TileLayer('tiles/bairros/{z}/{x}/{y}.png', {
			opacity: 0.5,
			minZoom: 10,
			maxZoom: 14
		}));

		//pesquisa, sistema viário
		omnivore.csv('https://docs.google.com/spreadsheets/d/e/2PACX-1vQBLSrcsNMwpbaF1ShxlSLeX7CdHAmOkX452MEoYgDEbMIF41DJmvN4Y2yv6Ge0nOp8DDh4B4r40xQG/pub?gid=828218726&single=true&output=csv').addTo(pesquisa);

		var searchControl = new L.Control.Search({
			layer: pesquisa,
			propertyName: 'nome',
			circleLocation: false,
			hideMarkerOnCollapse: true,
			textPlaceholder: "Pesquisa logradouro ou nº licença",
			textErr: "Não localizado",
			textCancel: "Cancelar",
			zoom: 17,
			openPopup: false,
			initial: false
		});

		map.addControl(searchControl);
		//camada não precisa ser visível, apenas para searchcontrol
		map.removeLayer(pesquisa);

		//#Saúde#
		var sauicon = L.icon({
			iconUrl: 'images/pesaude.png',
			iconAnchor:   [16,60],
			popupAnchor:  [0,-50],
			iconSize: [33,60]
		});

		omnivore.csv('https://docs.google.com/spreadsheets/d/e/2PACX-1vR8mVvyj07poY3l-BvOfX1UFx4EuuSWTP5972NUq0OUEoFy9woWSn85dgWJJX_x3wDc4MWswdxSq9Ad/pub?gid=0&single=true&output=csv')
		.on('ready', function(layer) {

			this.eachLayer(function(marker) {
				marker.setIcon(sauicon);
				marker.bindPopup(
					'<strong>' + '<u>' + marker.toGeoJSON().properties.nome + '</u>' + '</strong>' + '<br/>' +
					'Titularidade: ' + marker.toGeoJSON().properties.titula + '<br/>' +
					'Endereço: ' + marker.toGeoJSON().properties.end + ', ' + marker.toGeoJSON().properties.bairro + '<br/>' +
					'Telefone: ' + marker.toGeoJSON().properties.telefone+ '<br/>' +
					'nº Matrícula: ' + marker.toGeoJSON().properties.matriculan + '<br/>' +
					'Inscr.Imobiliária: ' + marker.toGeoJSON().properties.inscrimob
				);
			});
		}).addTo(sau);
			
		//#Prédios públicos#
		var ppublicon = L.icon({
			iconUrl: 'images/peedifpublic.png',
			iconAnchor:   [16,60],
			popupAnchor:  [0,-50],
			iconSize: [33,60]
		});

		omnivore.csv('https://docs.google.com/spreadsheets/d/e/2PACX-1vR8mVvyj07poY3l-BvOfX1UFx4EuuSWTP5972NUq0OUEoFy9woWSn85dgWJJX_x3wDc4MWswdxSq9Ad/pub?gid=1093102967&single=true&output=csv')
		.on('ready', function(layer) {

			this.eachLayer(function(marker) {
				marker.setIcon(ppublicon);
				marker.bindPopup(
					'<strong>' + '<u>' + marker.toGeoJSON().properties.nome + '</u>' + '</strong>' + '<br/>' +
					'Titularidade: ' + marker.toGeoJSON().properties.titula + '<br/>' +
					'Endereço: ' + marker.toGeoJSON().properties.end + ', ' + marker.toGeoJSON().properties.bairro + '<br/>' +
					'Telefone: ' + marker.toGeoJSON().properties.telefone+ '<br/>' +
					'nº Matrícula: ' + marker.toGeoJSON().properties.matriculan + '<br/>' +
					'Inscr.Imobiliária: ' + marker.toGeoJSON().properties.inscrimob
				);
			});
		}).addTo(ppubl);
		
		//#Educação#
		var educaicon = L.icon({
			iconUrl: 'images/paeduca.png',
			iconAnchor:   [16,60],
			popupAnchor:  [0,-50],
			iconSize: [33,60]
		});

		omnivore.csv('https://docs.google.com/spreadsheets/d/e/2PACX-1vR8mVvyj07poY3l-BvOfX1UFx4EuuSWTP5972NUq0OUEoFy9woWSn85dgWJJX_x3wDc4MWswdxSq9Ad/pub?gid=2142845276&single=true&output=csv')
		.on('ready', function(layer) {

			this.eachLayer(function(marker) {
				marker.setIcon(educaicon);
				marker.bindPopup(
					'<strong>' + '<u>' + marker.toGeoJSON().properties.nome + '</u>' + '</strong>' + '<br/>' +
					'Titularidade: ' + marker.toGeoJSON().properties.titula + '<br/>' +
					'Endereço: ' + marker.toGeoJSON().properties.end + ', ' + marker.toGeoJSON().properties.bairro + '<br/>' +
					'Telefone: ' + marker.toGeoJSON().properties.telefone+ '<br/>' +
					'nº Matrícula: ' + marker.toGeoJSON().properties.matriculan + '<br/>' +
					'Inscr.Imobiliária: ' + marker.toGeoJSON().properties.inscrimob
				);
			});
		}).addTo(educa);

		//#Desenvolvimento Social#
		var dsocialicon = L.icon({
			iconUrl: 'images/pedesenvsocial.png',
			iconAnchor:   [16,60],
			popupAnchor:  [0,-50],
			iconSize: [33,60]
		});

		omnivore.csv('https://docs.google.com/spreadsheets/d/e/2PACX-1vR8mVvyj07poY3l-BvOfX1UFx4EuuSWTP5972NUq0OUEoFy9woWSn85dgWJJX_x3wDc4MWswdxSq9Ad/pub?gid=176903385&single=true&output=csv')
		.on('ready', function(layer) {

			this.eachLayer(function(marker) {
				marker.setIcon(dsocialicon);
				marker.bindPopup(
					'<strong>' + '<u>' + marker.toGeoJSON().properties.nome + '</u>' + '</strong>' + '<br/>' +
					'Titularidade: ' + marker.toGeoJSON().properties.titula + '<br/>' +
					'Endereço: ' + marker.toGeoJSON().properties.end + ', ' + marker.toGeoJSON().properties.bairro + '<br/>' +
					'Telefone: ' + marker.toGeoJSON().properties.telefone+ '<br/>' +
					'nº Matrícula: ' + marker.toGeoJSON().properties.matriculan + '<br/>' +
					'Inscr.Imobiliária: ' + marker.toGeoJSON().properties.inscrimob
				);
			});
		}).addTo(dsocial);
		
		//#Cessão de uso#
		var cessusoicon = L.icon({
			iconUrl: 'images/pacessaodeuso.png',
			iconAnchor:   [16,60],
			popupAnchor:  [0,-50],
			iconSize: [33,60]
		});

		omnivore.csv('https://docs.google.com/spreadsheets/d/e/2PACX-1vR8mVvyj07poY3l-BvOfX1UFx4EuuSWTP5972NUq0OUEoFy9woWSn85dgWJJX_x3wDc4MWswdxSq9Ad/pub?gid=1750332736&single=true&output=csv')
		.on('ready', function(layer) {

			this.eachLayer(function(marker) {
				marker.setIcon(cessusoicon);
				marker.bindPopup(
					'<strong>' + '<u>' + marker.toGeoJSON().properties.nome + '</u>' + '</strong>' + '<br/>' +
					'Titularidade: ' + marker.toGeoJSON().properties.titula + '<br/>' +
					'Endereço: ' + marker.toGeoJSON().properties.end + ', ' + marker.toGeoJSON().properties.bairro + '<br/>' +
					'Telefone: ' + marker.toGeoJSON().properties.telefone+ '<br/>' +
					'nº Matrícula: ' + marker.toGeoJSON().properties.matriculan + '<br/>' +
					'Inscr.Imobiliária: ' + marker.toGeoJSON().properties.inscrimob
				);
			});
		}).addTo(cessuso);
		
		//#Áreas esportivas#
		var esportivicon = L.icon({
			iconUrl: 'images/paareasesportivas.png',
			iconAnchor:   [16,60],
			popupAnchor:  [0,-50],
			iconSize: [33,60]
		});

		omnivore.csv('https://docs.google.com/spreadsheets/d/e/2PACX-1vR8mVvyj07poY3l-BvOfX1UFx4EuuSWTP5972NUq0OUEoFy9woWSn85dgWJJX_x3wDc4MWswdxSq9Ad/pub?gid=1559994691&single=true&output=csv')
		.on('ready', function(layer) {

			this.eachLayer(function(marker) {
				marker.setIcon(esportivicon);
				marker.bindPopup(
					'<strong>' + '<u>' + marker.toGeoJSON().properties.nome + '</u>' + '</strong>' + '<br/>' +
					'Titularidade: ' + marker.toGeoJSON().properties.titula + '<br/>' +
					'Endereço: ' + marker.toGeoJSON().properties.end + ', ' + marker.toGeoJSON().properties.bairro + '<br/>' +
					'Telefone: ' + marker.toGeoJSON().properties.telefone+ '<br/>' +
					'nº Matrícula: ' + marker.toGeoJSON().properties.matriculan + '<br/>' +
					'Inscr.Imobiliária: ' + marker.toGeoJSON().properties.inscrimob
				);
			});
		}).addTo(esportiv);
		
		//#Praças#
		var pracasicon = L.icon({
			iconUrl: 'images/ppracas.png',
			iconAnchor:   [16,60],
			popupAnchor:  [0,-50],
			iconSize: [33,60]
		});

		omnivore.csv('https://docs.google.com/spreadsheets/d/e/2PACX-1vR8mVvyj07poY3l-BvOfX1UFx4EuuSWTP5972NUq0OUEoFy9woWSn85dgWJJX_x3wDc4MWswdxSq9Ad/pub?gid=1559994691&single=true&output=csv')
		.on('ready', function(layer) {

			this.eachLayer(function(marker) {
				marker.setIcon(pracasicon);
				marker.bindPopup(
					'<strong>' + '<u>' + marker.toGeoJSON().properties.nome + '</u>' + '</strong>' + '<br/>' +
					'Endereço: ' + marker.toGeoJSON().properties.endereco + ', ' + marker.toGeoJSON().properties.bairro + '<br/>' +
					'Lei: ' + marker.toGeoJSON().properties.lei + '<br/>' +
					'Obs: ' + marker.toGeoJSON().properties.obs + '<br/>' +
					'<img src="' + marker.toGeoJSON().properties.imgurl + '" alt="sem foto" style="width:300px;">' + '<br/>' +
					'<table><tr>' +
						'<td>Equipamentos disponvíveis: ' + '<br/>' +
						marker.toGeoJSON().properties.equip + '</td>' +
					'</tr></table>'
				);
			});
		}).addTo(pracas);		
		
		//marker clustering com suporte para layers
		var mcg = L.markerClusterGroup.layerSupport({ disableClusteringAtZoom: 17 }).addTo(map);
		mcg.checkIn([ sau, ppubl, educa, dsocial, cessuso, esportiv, pracas	]);
		sau.addTo(map);
		ppubl.addTo(map);
		educa.addTo(map);
		dsocial.addTo(map);
		cessuso.addTo(map);
		esportiv.addTo(map);
		pracas.addTo(map);
		
		//Controle de camadas
		var overlayMaps = {
		"<img src='images/pesaude.png' height='25' /> <a href='https://docs.google.com/spreadsheets/d/e/2PACX-1vTvqB-pK6_c3upEBRwndOmoXyrLDsaNg2UIXbOP9dVUD-f7LncVbGYILKJ8xI7orMpqmu7Neykp6yAo/pubhtml?gid=456279987&single=true' target='_blank' >Saúde</a>" : sau,
		"<img src='images/peedifpublic.png' height='25' /> <a href='https://docs.google.com/spreadsheets/d/e/2PACX-1vTvqB-pK6_c3upEBRwndOmoXyrLDsaNg2UIXbOP9dVUD-f7LncVbGYILKJ8xI7orMpqmu7Neykp6yAo/pubhtml?gid=1984217895&single=true' target='_blank' >Prédios públicos</a>" : ppubl,
		"<img src='images/paeduca.png' height='25' /> <a href='https://docs.google.com/spreadsheets/d/e/2PACX-1vTvqB-pK6_c3upEBRwndOmoXyrLDsaNg2UIXbOP9dVUD-f7LncVbGYILKJ8xI7orMpqmu7Neykp6yAo/pubhtml?gid=1907272550&single=true' target='_blank' >Educação</a>" : educa,
		"<img src='images/pedesenvsocial.png' height='25' /> <a href='https://docs.google.com/spreadsheets/d/e/2PACX-1vTvqB-pK6_c3upEBRwndOmoXyrLDsaNg2UIXbOP9dVUD-f7LncVbGYILKJ8xI7orMpqmu7Neykp6yAo/pubhtml?gid=1655631918&single=true' target='_blank' >Desenvolvimento Social</a>" : dsocial,
		"<img src='images/pacessaodeuso.png' height='25' /> <a href='https://docs.google.com/spreadsheets/d/e/2PACX-1vTvqB-pK6_c3upEBRwndOmoXyrLDsaNg2UIXbOP9dVUD-f7LncVbGYILKJ8xI7orMpqmu7Neykp6yAo/pubhtml?gid=1524391979&single=true' target='_blank' >Cessão de uso</a>" : cessuso,
		"<img src='images/paareasesportivas.png' height='25' /> <a href='https://docs.google.com/spreadsheets/d/e/2PACX-1vTvqB-pK6_c3upEBRwndOmoXyrLDsaNg2UIXbOP9dVUD-f7LncVbGYILKJ8xI7orMpqmu7Neykp6yAo/pubhtml?gid=1623303865&single=true' target='_blank' >Áreas esportivas</a>" : esportiv,
		"<img src='images/park.png' height='25' /> <a href='https://docs.google.com/spreadsheets/d/e/2PACX-1vTrFlUSn1OrVYOZ0MORZzWUPHwfCpsioEx2Tk4UCdB9ugjlw9HTxYD1Qt-WV32iNQl_heCeqF6phJ-c/pubhtml?gid=0&single=true' target='_blank' >Praças</a>" : pracas
		};
		
		var baseMaps = {
			"Sistema viário" : tilesmu,
			"Imagem, Google maps" : tilegoogle
		};
		L.control.layers(null, overlayMaps,{collapsed:false, position: 'topleft'}).addTo(map);
		L.control.layers(baseMaps, null,{position: 'topleft'}).addTo(map);

		//coordenadas no click
		var popup = L.popup();

		function onMapClick(e) {
		popup
			.setLatLng(e.latlng)
			.setContent(e.latlng.toString())
			.openOn(map);
		}
		map.on('click', onMapClick);

		</script>
	</body>
</html>